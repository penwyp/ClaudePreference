# m-orchestrated-dev - 多智能体协同开发工作流

## 概述

`m-orchestrated-dev` 是一个高级的多智能体协同开发工作流，通过部署三个专业化的智能体（编排者、开发者、审查者）来实现研究驱动的开发-审查循环。该命令适用于需要高质量代码和架构决策的复杂开发任务。

## 使用方法

```bash
/m-orchestrated-dev [target]
```

## 参数详解

- `target` (可选): 目标需求文档或项目范围
  - 默认值: 之前的讨论结果或当前需求
  - 支持格式: Markdown文件、需求文档、项目描述

## 智能体架构

### Agent O (编排者)
**角色**: 战略规划、架构决策和工作流协调

**核心职责**:
- 使用 `sequential-thinking` 进行复杂需求分析
- 研究最佳架构模式:
  - 使用 `context7` 进行框架评估和最佳实践研究
  - 使用 `web_search` (附加 "2025") 获取最新解决方案
  - 应用 `zen:consensus` 进行关键技术决策
- 创建基于证据的开发计划
- 协调开发者和审查者的工作
- 确保100%功能需求覆盖，70%非功能需求覆盖

### Agent D (开发者)
**角色**: 基于研究的实现和编码实践

**核心职责**:
- **关键要求**: 每个功能必须完全实现
- **禁止事项**: 不允许 TODO、FIXME、HACK、XXX、stub 或占位符代码
- 实现复杂功能前先进行研究
- 每次提交必须能够编译和运行
- 以生产就绪的质量进行实现

### Agent R (审查者)
**角色**: 通过外部基准进行综合验证

**审查优先级** (按顺序):
1. **代码完整性检查** (阻塞性)
2. **关键问题检查** (阻塞性)
3. **架构质量评估**
4. **需求覆盖验证**

## 使用示例

### 基本使用
```bash
/m-orchestrated-dev
```
**预期结果**: 分析当前项目需求，启动三智能体协同开发流程

### 指定需求文档
```bash
/m-orchestrated-dev requirements.md
```
**预期结果**: 基于 requirements.md 文件进行需求分析和开发规划

### 复杂项目开发
```bash
/m-orchestrated-dev "实现用户认证系统"
```
**预期结果**: 针对用户认证系统进行完整的设计、开发和审查流程

## 工作流程

### 1. 研究驱动规划 (Agent O)
- 输入: 需求文档
- 行动:
  1. 使用 `sequential-thinking` 分解需求
  2. 研究最佳解决方案
  3. 创建有证据支持的计划
- 输出: 详细的研究支持计划

### 2. 知情开发循环
- 编排者 → 开发者: 任务规范、推荐模式、架构约束
- 开发者行动: 研究复杂实现、完整解决方案实现、自验证
- 开发者 → 编排者: 完整实现、无占位符代码、构建验证通过

### 3. 综合审查
- 编排者 → 审查者: 代码、架构上下文、研究引用
- 审查者行动: 完整性检查、安全审计、架构合规性、需求映射
- 审查者 → 编排者: 详细发现、外部验证结果、接受/拒绝决策

## 决策矩阵

| 完整性 | 关键问题 | 功能需求 | 非功能需求 | 决策 |
|--------|----------|----------|------------|------|
| < 100% | - | - | - | 拒绝: 修复不完整代码 |
| 100% | 是 | - | - | 拒绝: 修复关键问题 |
| 100% | 否 | < 100% | - | 拒绝: 完成功能 |
| 100% | 否 | 100% | < 70% | 警告: 考虑改进 |
| 100% | 否 | 100% | ≥ 70% | 批准 |

## 预期结果

### 成功标准
- ✅ 100% 完整代码 (无占位符)
- ✅ 零关键安全/并发问题
- ✅ 100% 功能需求覆盖
- ✅ ≥70% 非功能需求覆盖
- ✅ 构建/编译成功
- ✅ 研究支持的架构决策

### 输出文件
- 项目统计报告
- 代码质量评估
- 需求履行情况
- 架构决策记录

## 配置选项

```yaml
max_cycles: 5                    # 最大循环次数
timeout_minutes: 60             # 超时时间
mcp_tools:
  enabled: ["web_search", "context7", "sequential_thinking", "zen:consensus"]
  web_search_suffix: "2025"     # 搜索后缀
strict_mode:
  no_incomplete_code: true      # 严格模式
  require_security_check: true # 需要安全检查
  min_functional_coverage: 100 # 最小功能覆盖
  min_non_functional_coverage: 70 # 最小非功能覆盖
```

## 最佳实践

1. **开始前**: 确保需求文档清晰完整
2. **研究先行**: 在编码前收集最佳实践
3. **质量为先**: 通过研究确保质量，通过纪律确保完整性
4. **迭代改进**: 使用研究指导改进
5. **完整交付**: 提供完整文档

## 故障排除

### 常见问题
- **循环次数超限**: 检查需求复杂度，考虑分解任务
- **构建失败**: 确保所有依赖正确安装
- **审查不通过**: 检查代码完整性和关键问题

### 错误处理
如果超过最大循环次数，系统将生成 `docs/todo/max-cycle-summary-<timestamp>.md` 文件，包含已完成工作和剩余任务。

## 相关命令

- [`m-task-planner`](m-task-planner.md) - 任务规划
- [`m-review-code`](m-review-code.md) - 代码审查
- [`m-security-scan`](m-security-scan.md) - 安全扫描
- [`m-test-generation`](m-test-generation.md) - 测试生成